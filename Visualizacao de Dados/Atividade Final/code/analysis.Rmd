---
title: "Visualização de Dados"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, memessage = F, warning = F, fig.width = 11, fig.height = 8)
options(scipen = 999999)
```


```{r message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(stringr)
library(magrittr)
library(purrr)
library(tidyr)
library(ggplot2)

base_gr <-
  map(1:5,
      ~ read_excel("../data/tabela_registro_civil.xlsx", skip = 4, n_max = 15, sheet = .x) %>%
        select(-c(1:4)) %>%
        rename_at(1, ~ c("ano")) %>%
        cbind(
          "GR" = read_excel("../data/tabela_registro_civil.xlsx", skip = 2, n_max = 2, sheet = .x) %>%
            select(1) %>%
            names() %>%
            str_sub(start = 49)
        ) %>%
        as_tibble() %>%
        mutate(GR = as.character(GR))
  )

base_uf <-
  map(6:32,
      ~ read_excel("../data/tabela_registro_civil.xlsx", skip = 4, n_max = 15, sheet = .x) %>%
        select(-c(1:4)) %>%
        rename_at(1, ~ c("ano")) %>%
        cbind(
          "UF" = read_excel("../data/tabela_registro_civil.xlsx", skip = 2, n_max = 2, sheet = .x) %>%
            select(1) %>%
            names() %>%
            str_sub(start = 49)
        ) %>%
        as_tibble() %>%
        mutate(UF = as.character(UF))
  )
```

## 1

Há uma questão científica ainda sem resposta nas estatísticas de nascimento do Brasil. Os brasileiros nascem mais entre março e maio, nove meses após o inverno. E nascem menos em novembro e dezembro - os filhos dos meses de Carnaval. Por que isso acontece ainda não é sabido.

```{r}
meses_12 <- base_gr %>% 
  bind_rows() %>% 
  gather(mes, value, -ano, -GR) %>% 
  distinct(mes)

base_gr %>% 
  bind_rows() %>% 
  gather(mes, value, -ano, -GR) %>% 
  mutate(value = as.numeric(value)) %>% 
  group_by(mes) %>% 
  summarise(media = mean(value, na.rm = T)) %>% 
  ungroup() %>% 
  mutate(mes = factor(mes, levels = meses_12$mes)) %>% 
  ggplot(aes(mes, media)) +
  geom_bar(stat = 'identity', fill = "#800000") +
  theme_minimal() +
  geom_text(aes(label = media %>% round), nudge_y = -1000, color = "white") +
  labs(x = "", y = "Média", title = "Média de nascimento por mês (2003-2017)")
```

## 2

A alta de nascimentos em março e queda em novembro ocorre em todo o Brasil, exceto na região Norte.

```{r}
base_gr %>% 
  bind_rows() %>% 
  gather(mes, value, -ano, -GR) %>% 
  # mutate(value = as.numeric(value)) %>% 
  group_by(GR, mes) %>% 
  summarise(media = mean(value, na.rm = T)) %>% 
  ungroup() %>% 
  mutate(mes = factor(mes, levels = meses_12$mes)) %>% 
  ggplot(aes(mes, media)) +
  geom_bar(stat = 'identity', fill = "#800000") +
  # scale_y_continuous(limits = c(0, 140000)) +
  facet_wrap(~ GR) +
  theme_minimal() +
  coord_flip() +
  geom_text(aes(label = media %>% round), nudge_y = 9000) +
  labs(x = "", y = "Média", title = "Média de nascimento por mês (2003-2017)")
  
```

