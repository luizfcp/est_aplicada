---
title: 'Visualização de Dados'
date: '03 de Julho de 2019'
author: 'Luiz Fernando, Lyncoln, Ronaldo'
output:
  prettydoc::html_pretty:
    theme: leonids
---

```{r setup, include=FALSE}
Sys.setlocale("LC_ALL","pt_BR.UTF-8")

knitr::opts_chunk$set(memessage = F, warning = F, fig.width = 11, fig.height = 8)
options(scipen = 999999)
```


```{r message=FALSE, warning=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(GGally)
library(readr)

# Base de dados separada por UF - Unidade da Federação
base_uf <- read_csv("../data/base por uf.csv")

# Base de dados separada por GR - Grande Região, apenas com o número de nascidos vivos por mês
base_gr <- read_csv("../data/base por gr.csv")%>% select(-X)

# Base de dados separada por GR - Grande Região, com a idade da mãe na ocasião do parto, sexo do nascido vivo e local de nasicmento
base_completa <- read_csv("../data/base por gr - idade da mae, sexo e local de nascimento.csv") %>% 
  mutate(domicilio = as.numeric(domicilio))

base_uf

base_gr

base_completa
```

## 1

Há uma questão científica ainda sem resposta nas estatísticas de nascimento do Brasil. Os brasileiros nascem mais entre março e maio, nove meses após o inverno. E nascem menos em novembro e dezembro - os filhos dos meses de Carnaval. Por que isso acontece ainda não é sabido.

```{r}
meses_12 <- base_gr %>% 
  bind_rows() %>% 
  gather(mes, value, -ano, -GR) %>% 
  distinct(mes)

base_gr %>% 
  bind_rows() %>% 
  gather(mes, value, -ano, -GR) %>% 
  mutate(value = as.numeric(value)) %>% 
  group_by(mes) %>% 
  summarise(media = mean(value, na.rm = T)) %>% 
  ungroup() %>% 
  mutate(mes = factor(mes, levels = meses_12$mes)) %>% 
  ggplot(aes(mes, media)) +
  geom_bar(stat = 'identity', fill = "#800000") +
  theme_minimal() +
  geom_text(aes(label = media %>% round), nudge_y = -1000, color = "white") +
  labs(x = "", y = "Média", title = "Média de nascimento por mês (2003-2017)")
```

## 2

A alta de nascimentos em março e queda em novembro ocorre em todo o Brasil, exceto na região Norte.

```{r}
base_gr %>% 
  bind_rows() %>% 
  gather(mes, value, -ano, -GR) %>% 
  group_by(GR, mes) %>% 
  summarise(media = mean(value, na.rm = T)) %>% 
  ungroup() %>% 
  mutate(mes = factor(mes, levels = meses_12$mes)) %>% 
  ggplot(aes(mes, media)) +
  geom_bar(stat = 'identity', fill = "#800000") +
  facet_wrap(~ GR) +
  theme_minimal() +
  coord_flip() +
  geom_text(aes(label = media %>% round), nudge_y = 9000) +
  labs(x = "", y = "Média", title = "Média de nascimento por mês (2003-2017)")
  
```

## 3

```{r message=FALSE, warning=FALSE}
base_gr %>% 
  gather(meses, value, -ano, -GR) %>% 
  spread(GR, value) %>% 
  select(-meses) %>% 
  tail(36) %>% 
  mutate(ano = as.character(ano)) %>% 
  ggpairs(
    columns = 2:6, mapping = aes(color = ano),
    lower = list( continuous = wrap(ggally_smooth_loess, size = 1, color = "darkblue")), 
    diag = list(continuous=wrap(ggally_barDiag, color="darkblue")), 
    upper = list( continuous = wrap("cor", size = 4.0, alignPercent = 1) )) + 
  theme(panel.background = ggplot2::element_rect(fill = "lightgray")) 
```

# rascunho

```{r}
base_completa %>% 
  group_by(grande_regiao) %>% 
  summarise(hospital = sum(hospital, na.rm = T),
            domicilio = sum(domicilio, na.rm = T)) %>% 
  gather(local, value, -grande_regiao) %>% 
  ggplot(aes(x = grande_regiao, y = value, fill = local)) +
  geom_bar(stat = 'identity')
```

```{r eval}
base_completa %>% 
  select(grande_regiao, sexo, hospital, domicilio) %>% 
  group_by(grande_regiao, sexo) %>% 
  summarise(hospital = sum(hospital, na.rm = T),
            domicilio = sum(domicilio, na.rm = T)) %>% 
  mutate(total = hospital+domicilio) %>%
  select(-hospital, -domicilio) %>% 
  ggplot(aes(x = sexo, y = total, fill = grande_regiao)) +
  facet_grid(~ grande_regiao) +
  geom_bar(stat = 'identity')
```

```{r}
base_completa %>% 
  select(grande_regiao, sexo, hospital, domicilio, mes_do_nascimento) %>% 
  group_by(grande_regiao, mes_do_nascimento, sexo) %>% 
  summarise(hospital = sum(hospital, na.rm = T),
            domicilio = sum(domicilio, na.rm = T)) %>% 
  mutate(total = hospital+domicilio) %>%
  select(-hospital, -domicilio) 
```

